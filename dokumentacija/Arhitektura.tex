\chapter{Arhitektura i dizajn sustava}
		
		Arhitektura aplikacije "Čuvari pasa" može se podijeliti na web poslužitelj, web aplikaciju i bazu podataka.
		\\
		\newline
		\textbf{Web poslužitelj} je zapravo funkcionalnost web aplikacije. On komunicira s klijentom preko web preglednika. Primarna uloga mu je "nabavljanje" HTTP zahtjeva i slanje HTTP odgovora. Ovisno o zahtjevu, web poslužitelj komunicira i s bazom podataka u kojoj se nalaze potrebni podaci. 
		\newline
		\textbf{Web preglednik} je softver koji služi kao sučelje između poslužitelja i klijenta i prikaz web dokumenta klijentu. Njegova primarna uloga je slanje HTTP zahtjeva i primanje HTTP odgovora. Web preglednici prevode kod koji dobivaju u HTTP odgovoru te ga zatim prikazuju.
		\newline
		\textbf{Baza podataka} (podatkovni sloj) koristi se za sigurno spremanje podataka. Povezana je s web aplikacijom koja joj šalje upite za potrebnim podacima. Baza podataka je dalje opisana u poglavlju 4.1 Baza podataka.
		\newline
		\textbf{Web aplikacija} podijeljena je na back-end i front-end. 
		\newline
		\textbf{Back-end} je dio sustava u kojem se zapravo obrađuju zahtjevi i vrše daljnje akcije. Njegova organizacija na kontrolere, servise i repozitorije pomaže u "razdvajanju zabrinutosti".
		Kontroleri upravljaju REST sučeljima prema poslovnoj logici koja je implementirana u servisima. Repozitoriji su zaslužni za spremanje i dohvaćanje nekog skupa podataka.
		Back-end također sadrži DTO-e (Data Transfer Object) i Domain modele. DTO-i se koriste za razmjenu podataka između procesa ili slojeva, a Domain modeli služe za razmjenu podataka s bazom podataka.
		\newline
		\textbf{Front-end} je prezentacijski dio aplikacije odnosno kako korisnik vidi aplikaciju u web pregledniku.
		\newline
		Front-end smo odlučili raditi u programskom jeziku JavaScript koristeći radni okvir React, a back-end u programskom jeziku Java s radnim okvirom Spring Boot. Razvojna okruženja u kojima radimo su Visual Studio Code i IntelliJ.
		
		\begin{figure}[htb]
			\centering
			\includegraphics[width=14cm]{slike/arhitekturaaa}
			\caption{Dijagram arhitekture web aplikacije} 
			\label{fig:arhitektura-dijagram}
		\end{figure}
		
		\eject
				
		\section{Baza podataka}
			
			Sustav koristi relacijsku bazu podataka koja će biti implementirana u PostgreSQLu. Relacijsku bazu podataka koristimo radi lakšeg oblikovanja sustava kao stvarnog svijeta, a PostgreSQL jer smo najbolje upoznati s njim. U njemu se entiteti modeliraju kao tablice koje imaju vlastito ime i skup atributa.\\
			Baza podataka nam je potrebna zbog njezine sigurnosti podataka, ali i brzog dohvata, pohrane i izmijene podataka koje sustav koristi za daljnje akcije.
			Baza podataka ovog sustava korisit sjedeće entitete:
			\begin{packed_item}
				\item role
				\item appuser
				\item breed
				\item dog
				\item request\_dog
				\item request\_guardian
				\item request\_guardians\_dog
				\item activity
				\item request\_activity
				\item agreed\_request
				
			\end{packed_item}
			
		
			\subsection{Opis tablica}
			
			
			\textbf{role} je entitet koji sadrži sve važne informacije o ulogama u  aplikaciji. Povezan je vezom One-To-Many s tablicom appuser preko atributa role\_id tablice role. Sadrži atribute: role\_id i name.
			
			
			
			
			\begin{longtblr}[
				label=none,
				entry=none
				]{
					width = \textwidth,
					colspec={|X[6,l]|X[6, l]|X[20, l]|}, 
					rowhead = 1,
				} %definicija širine tablice, širine stupaca, poravnanje i broja redaka naslova tablice
				\hline \multicolumn{3}{|c|}{\textbf{role}}	 \\ \hline[3pt]
				\SetCell{LightGreen}role\_id	& INT &  Jedinstven identifikator uloge korisnika 	\\ \hline
				name & VARCHAR &  Naziv uloge u sustavu \\ \hline
			 
			\end{longtblr}
			
			\textbf{appuser} je entitet koji sadrži sve važne informacije o korisniku aplikacije. Povezan je vezom Many-To-One s tablicom role preko atributa role\_id tablice role. S tablicom dog ima vezu Many-To-One koja je povezana preko atributa user\_id tablice appuser. Isto vrijedi za tablice request\_dog, request\_guardian i agreed\_request. Vlastiti atributi su: user\_id, role\_id, username, first\_name, last\_name, password, rating\_sum, rating\_count, email, has\_dog, has\_experience, blocked.

				
				
				
				\begin{longtblr}[
					label=none,
					entry=none
					]{
						width = \textwidth,
						colspec={|X[6,l]|X[6, l]|X[20, l]|}, 
						rowhead = 1,
					} %definicija širine tablice, širine stupaca, poravnanje i broja redaka naslova tablice
					\hline \multicolumn{3}{|c|}{\textbf{appuser}}	 \\ \hline[3pt]
					\SetCell{LightGreen}user\_id & INT	&  	Jedinstveni identifikator korisnika\\ \hline
					\SetCell{LightBlue}role\_id	& INT &  Jedinstven identifikator uloge korisnika (role.role\_id) \\ \hline
					username & VARCHAR &  Korisničko ime u sustavu \\ \hline 
					first\_name & VARCHAR	&  	Ime korisnika	\\ \hline
					last\_name & VARCHAR	&  	Prezime korisnika	\\ \hline
					password & VARCHAR	&  	Hash lozinke korisnika	\\ \hline 
					rating\_sum & INT	&  	Zbroj svih ocjena	\\ \hline 
					rating\_count & VARCHAR	&  	Broj svih ocjenjivanja	\\ \hline 
					email & VARCHAR	&  	Email pošta korisnika	\\ \hline 
					has\_dog & BOOLEAN	&  	Ima li korisnik psa	\\ \hline 
					has\_experience & BOOLEAN	&  	Ima li korisnik iskustvo	\\ \hline
					blocked & BOOLEAN	&  	Je li korisnik blokiran	\\ \hline  
				\end{longtblr}
			
			
			\textbf{breed} je entitet koji razlikuje sve pasmine u sustavu. Povezan je vezom Many-To-One s tablicom dog preko atributa breed\_id. Isto vrijedi i za tablicu request\_dog. Sadrži atribute: breed\_id i name.
		
		\begin{longtblr}[
				label=none,
				entry=none
				]{
					width = \textwidth,
					colspec={|X[6,l]|X[6, l]|X[20, l]|}, 
					rowhead = 1,
				} %definicija širine tablice, širine stupaca, poravnanje i broja redaka naslova tablice
				\hline \multicolumn{3}{|c|}{\textbf{breed}}	 \\ \hline[3pt]
				\SetCell{LightGreen}breed\_id & INT	&  	Jedinstveni identifikator pasmine\\ \hline
				name	& VARCHAR &  Naziv pasmine	\\ \hline 
				
			\end{longtblr}
		
		
			\textbf{dog} je entitet koji sadrži sve važne informacije o psima vlasnika. Povezan je vezom One-to-Many s tablicom appuser preko atributa user\_id i s tablicom breed preko atributa breed\_id. Vezom Many-To-One povezan je s tablicom request\_guardians\_dog preko atributa dog\_id. Sadrži atribute: dog\_id, name, rating\_sum, rating\_count, user\_id, breed\_id, date\_of\_birth, photo.
			\begin{longtblr}[
				label=none,
				entry=none
				]{
					width = \textwidth,
					colspec={|X[6,l]|X[6, l]|X[20, l]|}, 
					rowhead = 1,
				} %definicija širine tablice, širine stupaca, poravnanje i broja redaka naslova tablice
				\hline \multicolumn{3}{|c|}{\textbf{dog}}	 \\ \hline[3pt]
				\SetCell{LightGreen}dog\_id & INT	&  	Jedinstveni identifikator psa\\ \hline
				name	& VARCHAR &  Ima li čuvar iskustvo	\\ \hline 
				rating\_sum	& INT &  Zbroj svih ocjena	\\ \hline
				rating\_count	& VARCHAR &  Broj svih ocjenjivanja	\\ \hline
				\SetCell{LightBlue}user\_id	& INT &  Jedinstveni identifikator vlasnika pasa (appuser.user\_id)	\\ \hline
				\SetCell{LightBlue}breed\_id	& INT &  Jedinstveni identifikator pasmine (breed.breed\_id)	\\ \hline
				date\_of\_birth	& DATE &  Datum rođenja psa	\\ \hline 
				photo	& VARCHAR &  Slika psa	\\ \hline
				
			\end{longtblr}

			\textbf{request\_dog} je entitet koji sadrži sve važne informacije o oglasima koje čuvari pasa objavljuju. Povezan je vezom One-To-Many s tablicom breed preko atributa breed\_id i s tablicom appuser preko atributa user\_id. Vezom Many-To-One je povezan s tablicom agreed\_request preko atributa request\_dog\_id. Sadrži atribute: request\_dog\_id, dog\_age, dog\_time\_begin, dog\_time\_end, is\_flexible, location, number\_of\_dogs, is\_published, is\_reviewed, breed\_id, user\_id, location\_name.
			\begin{longtblr}[
				label=none,
				entry=none
				]{
					width = \textwidth,
					colspec={|X[7,l]|X[6, l]|X[20, l]|}, 
					rowhead = 1,
				} %definicija širine tablice, širine stupaca, poravnanje i broja redaka naslova tablice
				\hline \multicolumn{3}{|c|}{\textbf{request\_dog}}	 \\ \hline[3pt]
				\SetCell{LightGreen}request\_dog\_id & INT	&  	Jedinstveni identifikator oglasa za čuvanje pasa\\ \hline
				dog\_age	& INT &  Preferirana dob pasa	\\ \hline 
				dog\_time\_begin	& TIMESTAMP  &  Početak čuvanja pasa	\\ \hline 
				dog\_time\_end	& TIMESTAMP  &  Završetak čuvanja pasa	\\ \hline
				is\_flexible	& BOOLEAN &  Je li vrijeme čuvanja fleksibilno	\\ \hline
				location	& VARCHAR &  Koordinate lokacije čuvara pasa	\\ \hline
				number\_of\_dogs	& INT &  Broj pasa	\\ \hline
				is\_pusblished	& BOOLEAN &  Je li oglas objavljen	\\ \hline
				is\_reviewed	& BOOLEAN &  Je li oglas pregledan od strane administratora	\\ \hline
				\SetCell{LightBlue}breed\_id	& INT &  jedinstveni identifikator pasmine (breed.breed\_id)	\\ \hline
				\SetCell{LightBlue}user\_id	& INT &  jedinstveni identifikator čuvara pasa (appuser.user\_id)	\\ \hline
				location\_name	& VARCHAR &  Naziv lokacije čuvara pasa	\\ \hline
				
			\end{longtblr}
		
			\textbf{request\_guardian} je entitet koji sadrži sve važne informacije o oglasima koje vlasnici pasa objavljuju. Povezan je vezom One-To-Many s tablicom appuser preko atributa user\_id. Vezom Many-To-One je povezan s tablicom agreed\_request preko atributa request\_guardian\_id. Ima atribute: request\_guardian\_id, location, number\_of\_dogs, guard\_time\_begin, guard\_time\_end, is\_published, is\_reviewed, user\_id, has\_experience, has\_dog, location\_name.
			\begin{longtblr}[
				label=none,
				entry=none
				]{
					width = \textwidth,
					colspec={|X[10,l]|X[6, l]|X[20, l]|}, 
					rowhead = 1,
				} %definicija širine tablice, širine stupaca, poravnanje i broja redaka naslova tablice
				\hline \multicolumn{3}{|c|}{\textbf{request\_guardian}}	 \\ \hline[3pt]
				\SetCell{LightGreen}request\_guardian\_id & INT	&  	Jedinstveni identifikator zahtjeva za čuvanje pasa\\ \hline
				location	& VARCHAR &  Koordinate lokacije vlasnika pasa	\\ \hline 
				number\_of\_dogs	& INT &  Broj pasa	\\ \hline
				guard\_time\_begin	& TIMESTAMP  &  Početak čuvanja pasa	\\ \hline 
				guard\_time\_end	& TIMESTAMP  &  Završetak čuvanja pasa	\\ \hline
				is\_published	& BOOLEAN &  Je li zahtjev objavljen	\\ \hline
				is\_reviewed	& BOOLEAN &  Je li zahtjev pregledan od strane administratora	\\ \hline
				\SetCell{LightBlue}user\_id	& INT &  Jedinstveni identifikator vlasnika pasa, (appuser.user\_id)	\\ \hline
				has\_experience	& BOOLEAN &  Želi li vlasnik da čuvar ima iskustvo	\\ \hline
				has\_dog	& BOOLEAN &  Želi li vlasnik da čuvar ima vlastitog psa	\\ \hline
				location\_name	& VARCHAR &  Naziv lokacije vlasnika pasa	\\ \hline				
			\end{longtblr}
		
			\textbf{request\_guardians\_dog} je entitet koji sadrži sve važne informacije o psima koji su povezani s pojedinim zahtjevima koje je objavio vlasnik pasa. Potrebna je kako bi se unutar jednog zahtjeva za čuvanje moglo odabrati više pasa koje je potrebno istovremeno čuvati. Povezan je vezom One-To-Many s tablicom dog preko atributa dog\_id. Ima atribute: request\_guardians\_dog\_id, request\_guardian\_id, dog\_id.
			\begin{longtblr}[
				label=none,
				entry=none
				]{
					width = \textwidth,
					colspec={|X[12,l]|X[6, l]|X[20, l]|}, 
					rowhead = 1,
				} %definicija širine tablice, širine stupaca, poravnanje i broja redaka naslova tablice
				\hline \multicolumn{3}{|c|}{\textbf{request\_guardians\_dog}}	 \\ \hline[3pt]
				\SetCell{LightGreen}request\_guardians\_dog\_id & INT	&  	Jedinstveni identifikator psa povezanog sa zahtjevom za čuvanje\\ \hline
				\SetCell{LightBlue}request\_guardian\_id	& INT &  Jedinstveni identifikator zahtjeva za čuvanje pasa, (request\_guardian.request\_guardian\_id)	\\ \hline
				\SetCell{LightBlue}dog\_id	& INT &  jedinstveni identifikator psa, (dog.dog\_id)	\\ \hline
				
				
			\end{longtblr}			
		
			\textbf{activity} je entitet koji sadrži sve važne informacije o aktivnosti koje bi pas i čuvar radili. Povezan je vezom Many-To-One s tablicom request\_activity preko atributa activity\_id. Ima atribute: activity\_id, activity\_name.
			\begin{longtblr}[
				label=none,
				entry=none
				]{
					width = \textwidth,
					colspec={|X[6,l]|X[6, l]|X[20, l]|}, 
					rowhead = 1,
				} %definicija širine tablice, širine stupaca, poravnanje i broja redaka naslova tablice
				\hline \multicolumn{3}{|c|}{\textbf{activity}}	 \\ \hline[3pt]
				\SetCell{LightGreen}activity\_id & INT	&  Jedinstveni identifikator aktivnosti \\ \hline
				activity\_name	& INT &  Naziv aktivnosti	\\ \hline
				
				
			\end{longtblr}			
		
		\textbf{request\_activity} je entitet koji sadrži sve važne informacije o aktivnostima koje pripadaju odgovarajućem zahtjevu za čuvanje pasa. Povezan je vezom One-To-Many s tablicom activity preko atributa activity\_id i s tablicom request\_guardian preko atributa request\_guardian\_id. Sadrži atribute: request\_activity\_id, activity\_id, feeding\_quantitiy, request\_guardian\_id. 
		\begin{longtblr}[
			label=none,
			entry=none
			]{
				width = \textwidth,
				colspec={|X[10,l]|X[6, l]|X[20, l]|}, 
				rowhead = 1,
			} %definicija širine tablice, širine stupaca, poravnanje i broja redaka naslova tablice
			\hline \multicolumn{3}{|c|}{\textbf{request\_activity}}	 \\ \hline[3pt]
			\SetCell{LightGreen}request\_activity\_id & INT	&  Jedinstveni identifikator aktivnosti koja priprada odgovarajućem zahtjevu za čuvanje pasa \\ \hline
			\SetCell{LightBlue}activity\_id	& INT &  Jedinstveni identifikator aktivnosti, (activity.activitity\_id)	\\ \hline
			feeding\_quantity	& INT &  Količina hrane ukoliko je odabrana aktivnost povazana s hranjenjem	\\ \hline
			\SetCell{LightBlue}request\_guardian\_id	& VARCHAR &  Jedinstveni identifikator zahtjeva za čuvanje pasa (request\_guardian.request\_guardian\_id) \\ \hline
			
			
		\end{longtblr}	
	
		\textbf{agreed\_request} je entitet koji sadrži sve važne informacije o dogovorenim zahtjevima vlasnika i čuvara. Povezan je vezom One-To-Many s tablicom request\_guardian preko atributa request\_guardian\_id, s tablicom request\_dog preko atributa request\_dog\_id i s tablicom appuser preko atributa initiator\_user\_id i user\_id. Sadrži atribute: agreed\_request\_id, is\_agreed, agreed\_time\_begin, agreed\_time\_end, request\_guardian\_id, request\_dog\_id, initiator\_user\_id, user\_id, initiator\_rated, user\_rated
		
		\begin{longtblr}[
			label=none,
			entry=none
			]{
				width = \textwidth,
				colspec={|X[10,l]|X[6, l]|X[20, l]|}, 
				rowhead = 1,
			} %definicija širine tablice, širine stupaca, poravnanje i broja redaka naslova tablice
			\hline \multicolumn{3}{|c|}{\textbf{agreed\_request}}	 \\ \hline[3pt]
			\SetCell{LightGreen}agreed\_request\_id & INT	&  Jedinstveni identifikator dogovorenih zahtjeva \\ \hline
			is\_agreed	& BOOLEAN &  Je li postignut dogovor	\\ \hline
			agreed\_time\_begin	& TIMESTAMP &  Dogovoren početak čuvanja \\ \hline
			agreed\_time\_end	& TIMESTAMP &  Dogovoren kraj čuvanja	\\ \hline
			\SetCell{LightBlue}request\_guardian\_id	& INT &  Jedinstveni identifikator zahtjeva za čuvanje pasa (request\_guardian.request\_guardian\_id) \\ \hline
			\SetCell{LightBlue}request\_dog\_id	& INT &  Jedinstveni identifikator oglasa za čuvanje pasa (request\_dog.request\_dog\_id)\\ \hline
			\SetCell{LightBlue}initiator\_user\_id	& INT &  Jedinstveni identifikator korisnika koji je započeo interakciju (appuser.user\_id) \\ \hline
			\SetCell{LightBlue}user\_id	& INT &  Jedinstveni identifikator korisnika s kojim je započeta interakcija (appuser.user\_id) \\ \hline
			initiator\_rated	& BOOLEAN &  Je li korisnik koji je započeo interakciju ocijenio doživljaj \\ \hline
			user\_rated	& BOOLEAN &  Je li korisnik s kojim je započeta interakcija ocijenio doživljaj \\ \hline
			
		\end{longtblr}	
				
			
			
		\eject
			\subsection{Dijagram baze podataka}
			
			\begin{figure}[htb]
				\centering
				\includegraphics[width=16cm]{slike/drawsql REL}
				\caption{Relacijski dijagram baze podataka} 
				\label{fig:E-Rdijagram}
			\end{figure}
			
			\eject
			
			
		\section{Dijagram razreda}
		
			Na slikama 4.3, 4.4 i 4.5 prikazani su razredi koji pripadaju backend dijelu s arhitekturom podijeljenom na kontrolere, repozitorije i servise te uključujući Domain i DTO (Data Transfer Object) modele.\\
			Na slici 4.3 prikazani du razredi koji nsljeđuju Controller razred. Metode implementirane u tim razredima mainpuliraju s DTO-ima, a oni su dohvaćeni pomoću metoda implemntiranih u Domain razredima.
			
			\begin{figure}[htb]
				\centering
				\includegraphics[width=16cm]{slike/class_diagram_controllers}
				\caption{Dijagram razreda - dio Controllers} 
				\label{fig:Class-Diagram}
			\end{figure}
		
		
			Data Transfer Objects služe za razmjenu podataka između procesa ili slojeva.\\
			RegistertUser i ReqisterDog služe za stvaranje novog objekta User odnosno Dog.
			NewRequestDog i NewRequestGuardian služa za stvaranje novog objekta RequestDog odnosno RequestGuardian.
			RatedDogsList služi za primanje podaka o ocijenjenim psima.
			RequestDogDTO, RequestGuardianDTO, RequestBothDTO služe kao pomoćni objekti za čitanje tih objekata iz baze.
			\eject
			
			\begin{figure}[htb]
				\centering
				\includegraphics[width=16cm]{slike/class_diagrams_dtos}
				\caption{Dijagram razreda - dio Data Transfer Objects}
				\label{fig:Class-Diagram}
			\end{figure}
		
		
			Domain razredi preslikavaju strukturu baze podataka u aplikaciji. Implementirane metode direktno komuniciraju s bazom podataka te vraćaju tražene podatke.\\
			Razred AppUser predstavlja korisnika web aplikacije koji se može registrirati unoseći potrebne informacije. On može izabrati svoju ulogu pri registraciji (razred Role). Administrator je korisnik aplikacije koji ima sve mogućnosti App Usera. Vlasnik pasa može dodati vlastitog psa u sustav (razred Dog). Vlasnik odnosno čuvar mogu tražiti čuvara za svog pasa (razred RequestGuardian) odnosno psa za čuvanje (razred RequestDog). Vlasnik može i tražiti koju aktivnost će čuvar raditi sa psom (razredi Activity i RequestActivity). Dogovor vlasnika i čuvara predstavlja razred AgreedRequest. U RequestGuardiansDog se popisuju psi koju se koriste u zahtjevu RequestGuardian.
			
			\begin{figure}[htb]
				\centering
				\includegraphics[width=16cm]{slike/class_diagram_domain}
				\caption{Dijagram razreda - dio Domain}
				\label{fig:Class-Diagram}
			\end{figure}
	
			\eject
		
		\section{Dijagram stanja}
			
			
			\textbf{\textit{dio 2. revizije}}\\
			
			\textit{Potrebno je priložiti dijagram stanja i opisati ga. Dovoljan je jedan dijagram stanja koji prikazuje \textbf{značajan dio funkcionalnosti} sustava. Na primjer, stanja korisničkog sučelja i tijek korištenja neke ključne funkcionalnosti jesu značajan dio sustava, a registracija i prijava nisu. }
			
			
			\eject 
		
		\section{Dijagram aktivnosti}
			
			\textbf{\textit{dio 2. revizije}}\\
			
			 \textit{Potrebno je priložiti dijagram aktivnosti s pripadajućim opisom. Dijagram aktivnosti treba prikazivati značajan dio sustava.}
			
			\eject
		\section{Dijagram komponenti}
		
			\textbf{\textit{dio 2. revizije}}\\
		
			 \textit{Potrebno je priložiti dijagram komponenti s pripadajućim opisom. Dijagram komponenti treba prikazivati strukturu cijele aplikacije.}